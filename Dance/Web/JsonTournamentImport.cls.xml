<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Class name="Dance.Web.JsonTournamentImport">
<Super>Dance.Web.JsonBase</Super>
<TimeCreated>63317,64514.811683</TimeCreated>

<Method name="ConvertToProxyObject">
<Description>
Convert "Tournament imported" object to %ZEN.proxyObject (for JSON)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>object:Dance.Data.Import.Tournament,isFullInfo:%Boolean=0</FormalSpec>
<ReturnType>%ZEN.proxyObject</ReturnType>
<Implementation><![CDATA[
	set proxy = ##class(%ZEN.proxyObject).%New()
	set proxy.item = ##class(%ZEN.proxyObject).%New()
	set proxy.info = ##class(%ZEN.proxyObject).%New()
	
	try{
		set proxy.item.id = object.%Id()
		set proxy.item.idInternal = object.IdInternal
		set proxy.item.IdExternal = object.IdExternal
		set proxy.item.hash = $E(object.Hash, 0, 5)_"..."
		set proxy.item.date = object.TDate
		set proxy.item.name = $REPLACE(object.Name, $c(10), "")
	
		set proxy.info.isExisted = ##class(Dance.Data.Tournament).IdInternalIdxExists(object.IdInternal)
		set proxy.info.isRemoved = object.IsRemoved 
	}
	catch(ex){
		set proxy = ##class(%ZEN.proxyObject).%New()
	}
	
	quit proxy
]]></Implementation>
</Method>

<Method name="WriteAllForGridToDevice">
<Description>
Write objects to device, page by page for grid. </Description>
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set st = $$$OK
	
	try{
		
		$$$THROWONERROR(st, ##class(Dance.Data.Tournament).CheckUpdatePrivilege())
	
		$$$THROWONERROR(st, ##class(Dance.Data.Import.Tournament).Import("Dance.Data.Import.Tournament", $G(^Settings("Dance", "Import", "TournamentsPage"))))
	
		$$$THROWONERROR(st, ##class(%ZEN.Auxiliary.jsonProvider).%ConvertJSONToObject(%request.Content,,.params, 1))
      	
      	set whereCondition = ""
      	
      	$$$THROWONERROR(st, ..WriteJsonForGrid("SELECT ID FROM Dance_Data_Import.Tournament", "Dance.Data.Import.Tournament", params, whereCondition))
	}
	catch ex {
		set st = ex.AsStatus()
	}

	quit st
]]></Implementation>
</Method>
</Class>
</Export>
