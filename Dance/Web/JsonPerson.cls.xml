<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Class name="Dance.Web.JsonPerson">
<Super>Dance.Web.JsonBase</Super>
<TimeCreated>63294,86309.969149</TimeCreated>

<Method name="ConvertToProxyObject">
<Description>
Convert "Person" object to %ZEN.proxyObject (for JSON)</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>object:Dance.Data.Person,isFullInfo:%Boolean=0</FormalSpec>
<ReturnType>%ZEN.proxyObject</ReturnType>
<Implementation><![CDATA[
	set proxy = ##class(%ZEN.proxyObject).%New()
	
	try{
		set proxy.id = object.%Id()
		set proxy.lastName = object.LastName.Value
		set proxy.firstName = object.FirstName.Value
		set proxy.gender = object.Gender
		set proxy.dob = $ZDATE(object.DOB, 3)
		
		set proxy.numberUDSR = object.NumberUDSR
		set proxy.numberWDSF = object.NumberWDSF
		
		set proxy.country = ##class(JsonCountry).ConvertToProxyObject(object.Country)
		
		set proxy.laClass = ##class(JsonDancerClass).ConvertToProxyObject(object.LAClass)
		set proxy.stClass = ##class(JsonDancerClass).ConvertToProxyObject(object.STClass)
	}
	catch(ex){
		set proxy = ##class(%ZEN.proxyObject).%New()
	}
	
	quit proxy
]]></Implementation>
</Method>

<Method name="Save">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	set st = $$$OK
	
	try{
		TSTART
		
		$$$THROWONERROR(st, ##class(Dance.Data.Tournament).CheckUpdatePrivilege())
		
		$$$THROWONERROR(st, ##class(%ZEN.Auxiliary.jsonProvider).%ConvertJSONToObject($ZCVT(%request.Content.Read(),"I", "UTF8"),,.data, 1))
      	
      	if (data.id = ""){
      		set person = ##class(Dance.Data.Person).%New()
			set person.LastName = ##class(Dance.Data.Localization.LText).Create(data.lastName, "Dance.Data.Localization.Translation;PersonLTextValue")		
			set person.FirstName = ##class(Dance.Data.Localization.LText).Create(data.firstName, "Dance.Data.Localization.Translation;PersonLTextValue")		
			set person.MiddleName = ##class(Dance.Data.Localization.LText).Create(data.middleName, "Dance.Data.Localization.Translation;PersonLTextValue")		
      	}
      	else{
			set person.LastName = data.lastName
			set person.FirstName = data.firstName
			set person.MiddleName.Value = data.middleName				
      	}
      	
      	set person.DOB = $ZDATEH(data.dob, 15)
     	set person.Gender = data.gender
     	set person.NumberUDSR = data.numberUDSR
     	set person.NumberWDSF = data.numberWDSF
     	
     	set st = person.%Save()
      	if $$$ISERR(st) $$$ThrowStatus(##class(Dance.Utils.Msg).GetErrorStatus("SavePersonError"," | "_st))
      	 	
      	TCOMMIT
	}
	catch ex {
		TROLLBACK
		set st = ex.AsStatus()
	}
			
	quit st
]]></Implementation>
</Method>
</Class>
</Export>
