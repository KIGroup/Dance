<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<CSP name="dance/js/directives/competitionform.js" application="/csp/dance/" default="1"><![CDATA[
'use strict';
//     

directivesModule.directive('competitionform', function(){
    return {
        replace: true,
        restrict: 'E',
        templateUrl: 'components/competitionform.csp',
        
        scope: {
            competition: '=',
            tournament: '='       
        },
        controller: function($scope, DisciplineSrvc, AgeCategorySrvc, CompetitionSrvc, UtilsSrvc){
            $scope.competitionsWDSF = [];

            /// Load Disciplines
            $scope.loadDisciplines = function(){
                DisciplineSrvc.getAll().then(
                    function(data){
                        $scope.disciplines = data.children;
                    },
                    function(data, status, headers, config){
                    });
            };

            /// Load Age Categories
            $scope.loadAgeCategories = function(){
                AgeCategorySrvc.getAll().then(
                    function(data){
                        $scope.ageCategories = data.children;
                    },
                    function(data, status, headers, config){
                    });
            };
           
            /// Load types
            $scope.loadTypes = function(){
                CompetitionSrvc.getTypes().then(
                    function(data){
                        $scope.types = data.children;
                    },
                    function(data, status, headers, config){
                    });
            };
			  
            $scope.loadCompetitionsWDSFByFilter = function(){
                $scope.competition.startDate = UtilsSrvc.getValidDate($scope.competition.startDate);
                if ($scope.competition.startDate=="")
                    return;
               
                var trnId = $scope.competition.id ? $scope.competition.tournament.location.country.id : $scope.tournament.location.country.id;

                CompetitionSrvc.getWDSFByFilter(trnId, $scope.competition.startDate).then(
                    function(data){
                        $scope.competitionsWDSF = data.children;
                    },
                    function(data, status, headers, config){
                    });
            };

            $scope.$watch('competition.isInternational', function(){
                if (!$scope.competition.isInternational)
                    return;

                $scope.loadCompetitionsWDSFByFilter();
            });

            $scope.clickOnDate = function(){
                $scope.competitionsWDSF = [];
                $scope.competition.wdsf = {};
                $scope.competition.isInternational = false;
            };

            $scope.loadDisciplines();
            $scope.loadAgeCategories();
            $scope.loadTypes();
	   	}
    }
});
]]></CSP>
</Export>
